## for Rdoc markup syntax and options please see:http://rdoc.sourceforge.net/doc/ EXAMPLE and MARKUP sections

= RightScale *** cookbook

== DESCRIPTION:
Replace this text with a high-level overview of what this cookbook configures or manages.  Don't go into too much detail here, save that for the 'details' section below.

Example:
This cookbook provides abstract 'repo' resource for managing code download from GIT, SVN or ROS code repositories.

== REQUIREMENTS:
=== General

Replace this text with a description of cookbook requirements, what user will have to add to template to make recipes from this cookbook work correctly
What OSs does this support?
Is this cloud specific?  If so, which clouds?
Requires a virtual machine launched from a RightScale-managed RightImage.

Example:
One of 'repo' provider: 'repo_git', 'repo_svn' or 'repo_ros' cookbooks must be present in your cookbook repository`
`Ros implementation depends on either the 'rs_utils::install_tools' or 'rs_tools:default' recipe`

=== Cookbooks dependencies
Please see metadata.rb file for the latest dependencies.

== KNOWN LIMITATIONS:
List any known limitation here that might affect functionality and usability. Be sure to include a ticket number.

Example:
`Currently only primary backups to Remote Object Storage (ROS) are supported for KVM hypervisors (w-1234)`

== SETUP/USAGE:
Describe minimum requred set of actions requred for correct work of recipes from this cookbook.

Example:
`Place tomcat::default recipe into your runlist to setup the application server.`
`When using a RightScale ServerTemplate, this will also automatically add the common attributes to your ServerTemplate inputs.`
`Set ‘jdbc/ConnDB’ as your datasource name to setup database connection with the application server.`
or
`Using this cookbook is relatively straightforward. Add the desired recipes to the run list of a node, or create a role.`
`Depending on your environment, you may have multiple roles that use different recipes from this cookbook. Adjust any attributes as desired.`

== DETAILS:
=== General

Replace this text with a common information about cookbook elements, and what user need to know if he want to use this cookbook

Example:
#This cookbook is intended to be used in conjunction with cookbooks that contain
#Lightweight Providers which implement the 'repo' interface. See the RightScale
#repo_git cookbook for an example.

#For more about Lightweight Resources and Providers (LWRPs), please see the Chef
#wiki at: http://wiki.opscode.com/display/chef/Lightweight+Resources+and+Providers+%28LWRP%29

=== Attributes
Describe cookbook attributes here.
You can create subsections to split attributes by their specs Ex: `apache common`, `apache worker` etc.

Example:
`These are settings used in recipes and templates. Default values are noted.`
* `node['apache']['dir']` - Location for the Apache configuration
* `node['apache']['log_dir']` - Location for Apache logs
* `node['apache']['prefork']['startservers']` - initial number of server processes to start. Default is 16.
* `node['apache']['prefork']['minspareservers']` - minimum number of spare server processes. Default 16.

=== Templates
Describe cookbook templates here.
Format is:
template name - description - recipe/recipes where this tempalte is called

Example:
server.rb.erb
-------------
Configuration for the server and server components used in the `chef-server::rubygems-install` recipe.


=== Recipes
Replace this text with a complete overview of cookbook recipes.
Each recipe description must be a section which will contain info about recipe purpose and usage.

Example:
rubygems-install
----------------
ONLY FOR RUBYGEMS INSTALLATIONS. Do not use this recipe if you installed Chef from packages for your platform.
Use this recipe to "bootstrap" a system to become a Chef Server. This recipe does the following:

* Creates a `chef` user.
* Installs CouchDB from package or source depending on the platform.
* Installs Java for the `chef-solr` search engine.
* Installs RabbitMQ with the `chef-server::rabbitmq` recipe for the chef-expander consumer.
* Installs Gecode with the `gecode` cookbook. On Debian/Ubuntu, Opscode's APT repository will be used. On other platforms, Gecode will be installed from source, which can take a long time.
* Installs all the Server-related RubyGems.

Minimal JSON to use for the server configuration:
    {
      "chef_server": {
        "url": "http://localhost.localdomain:4000",
      },
      "run_list": "recipe[chef-server::rubygems-install]"
    }

=== Definitions
Use this section only if your cookbook contain definitions.
Give complete description of difinition functionality and provide examples of how we use it in recipes.

apache\_module
--------------
Enable or disable an Apache module in `#{node['apache']['dir']}/mods-available` by calling `a2enmod` or `a2dismod` to manage the symbolic link in `#{node['apache']['dir']}/mods-enabled`. If the module has a configuration file, a template should be created in the cookbook where the definition is used. See __Examples__.
Example:
### Parameters:
* `name` - Name of the module enabled or disabled with the `a2enmod` or `a2dismod` scripts.
* `enable` - Default true, which uses `a2enmod` to enable the module. If false, the module will be disabled with `a2dismod`.
* `conf` - Default false. Set to true if the module has a config file, which will use `apache_conf` for the file.
* `filename` - specify the full name of the file, e.g.

### Examples:
Enable the ssl module, which also has a configuration template in `templates/default/ssl.conf.erb`.

    apache_module "ssl" do
      conf true
    end

=== Libraries-helpers
Use this section only if your cookbook contain definitions.
Give complete description of library purpose and  functionality. Provide examples of how we use it in recipes.

Example:
RightScale::App::Helper.bind_ip(private_ips = [ ], public_ips = [ ])
--------------------------------------------------------------------
Return the IP address of the interface that this application server listens on.

##Parameters
* `private_ips(Array)::` List of private ips assigned to the application server
* `public_ips(Array)::` List of public ips assigned to the application server

##Returns
* `String::` IP Address

##Raise
`RuntimeError::` If nether a valid private nor public ip can be found

=== LWRP's

Use this section only if your cookbook contain resources and/or providers.
Describe resource purpose and functionality. describe its attributes
<b>Example:</b>
<i>#Common attributes
:destination - Path to where project repo will be pulled
:repository - Repository Url
:revision - Remote repo Branch or revision
</i>

Give provider usage examples.
<b>Example:</b>
Update Action
-------------
To open a local port to all servers with a given tag use:

  sys_firewall "Open this database's ports to all appservers" do
    machine_tag "appserver:active=true"
    port 3306
    enable true
    action :update
  end

This can be useful as a server is booting to open up access for multiple
systems at once.

Update Request Action
---------------------
To request all servers with a given tag close a port to a given IP address use:

  sys_firewall "Request all appservers close ports to this loadbalancer" do
    machine_tag "loadbalancer:app=www"
    port 8000
    enable false
    ip_addr node[:cloud][:private_ips][0]
    action :update_request
  end

This can be useful when decommissioning a running server that had previously
requested ports opened.


* all tag based actions are scoped to the deployment

= LICENSE
Cookbook license section.


<b>Example:</b>
<b>RightScale Cookbooks</b>

Copyright RightScale, Inc. All rights reserved.  All access and use subject to the
RightScale Terms of Service available at http://www.rightscale.com/terms.php and,
if applicable, other agreements such as a RightScale Master Subscription Agreement.

